<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPFL Informatique 3rd Year Course Planner</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .semester-toggle-btn {
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 2px;
            padding: 2px 6px;
            cursor: pointer;
            font-size: 0.7rem;
            font-weight: bold;
            margin-right: 5px;
        }

        .semester-toggle-btn:hover {
            background: #1976d2;
        }

        /* Enhanced selected card styling */
        .course-card.selected {
            border: 2px solid #4caf50 !important;
            background: linear-gradient(135deg, #e8f5e8, #f1f8e9) !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3) !important;
        }

        .course-card.selected .course-title {
            color: #2e7d32;
            font-weight: bold;
        }

        .course-card.selected .course-credits {
            background: #4caf50;
            box-shadow: 0 2px 4px rgba(76, 175, 80, 0.4);
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>EPFL Informatique 3rd Year Course Planner</h1>

        <!-- Top Summary Dashboard -->
        <div class="top-summary">
            <div class="summary-card">
                <div class="summary-title">BA5 (Autumn 2025)</div>
                <div class="summary-credits" id="top-ba5-credits">8cr</div>
                <small>Including fixed courses</small>
            </div>
            <div class="summary-card">
                <div class="summary-title">BA6 (Spring 2026)</div>
                <div class="summary-credits" id="top-ba6-credits">14cr</div>
                <small>Including fixed courses</small>
            </div>
            <div class="summary-card">
                <div class="summary-title">Total 3rd Year</div>
                <div class="summary-credits" id="top-total-credits">22 / 62cr</div>
                <small>Need 62 credits total</small>
            </div>
        </div>

        <div class="planner">
            <!-- BA5 (Autumn) Column -->
            <div class="semester-column">
                <h2 class="semester-title">BA5 (Autumn 2025)</h2>

                <div class="fixed-section">
                    <h3>Bloc C (Fixed)</h3>
                    <div class="fixed-course">
                        <div class="fixed-course-info">
                            Computer security and privacy<br>
                            <small>COM-301 • 6cr • EN</small>
                        </div>
                        <button class="fixed-course-btn"
                            onclick="openCourseLink('https://edu.epfl.ch/studyplan/fr/bachelor/informatique/coursebook/computer-security-and-privacy-COM-301')">Link</button>
                    </div>
                </div>

                <div class="category-section">
                    <div class="category-title">Options</div>
                    <div id="ba5-options-list"></div>
                </div>

                <div class="category-section">
                    <div class="category-title">Projects</div>
                    <div id="ba5-projects-list"></div>
                </div>

                <div class="category-section">
                    <div class="category-title">Bio/Physique</div>
                    <div id="ba5-bio-list"></div>
                </div>

                <div class="fixed-section">
                    <h3>SHS (Fixed)</h3>
                    <div>2 credits</div>
                </div>

                <div class="credits-summary">
                    <div class="credits-line"><span>Bio/Physique:</span> <span id="ba5-bio">0cr</span></div>
                    <div class="credits-line"><span>Projects:</span> <span id="ba5-projects">0cr</span></div>
                    <div class="credits-line"><span>Options:</span> <span id="ba5-options">0cr</span></div>
                    <div class="credits-line credits-total"><span>Total Selected:</span> <span id="ba5-total">0cr</span>
                    </div>
                    <div class="credits-line credits-final"><span>Semester Total:</span> <span id="ba5-final">8cr</span>
                    </div>
                </div>
            </div>

            <!-- Available Courses Column -->
            <div class="courses-column">
                <h2 style="text-align: center; margin-bottom: 20px;">Available Courses</h2>
                <div id="courses-container"></div>
            </div>

            <!-- BA6 (Spring) Column -->
            <div class="semester-column">
                <h2 class="semester-title">BA6 (Spring 2026)</h2>

                <div class="fixed-section">
                    <h3>Bloc C (Fixed)</h3>
                    <div class="fixed-course">
                        <div class="fixed-course-info">
                            Data-intensive systems<br>
                            <small>CS-300 • 6cr • EN</small>
                        </div>
                        <button class="fixed-course-btn"
                            onclick="openCourseLink('https://edu.epfl.ch/studyplan/fr/bachelor/informatique/coursebook/data-intensive-systems-CS-300')">Link</button>
                    </div>
                    <div class="fixed-course" style="margin-top: 8px;">
                        <div class="fixed-course-info">
                            Theory of computation<br>
                            <small>CS-251 • 6cr • EN</small>
                        </div>
                        <button class="fixed-course-btn"
                            onclick="openCourseLink('https://edu.epfl.ch/studyplan/fr/bachelor/informatique/coursebook/theory-of-computation-CS-251')">Link</button>
                    </div>
                </div>

                <div class="category-section">
                    <div class="category-title">Options</div>
                    <div id="ba6-options-list"></div>
                </div>

                <div class="category-section">
                    <div class="category-title">Projects</div>
                    <div id="ba6-projects-list"></div>
                </div>

                <div class="category-section">
                    <div class="category-title">Bio/Physique</div>
                    <div id="ba6-bio-list"></div>
                </div>

                <div class="fixed-section">
                    <h3>SHS (Fixed)</h3>
                    <div>2 credits</div>
                </div>

                <div class="credits-summary">
                    <div class="credits-line"><span>Bio/Physique:</span> <span id="ba6-bio">0cr</span></div>
                    <div class="credits-line"><span>Projects:</span> <span id="ba6-projects">0cr</span></div>
                    <div class="credits-line"><span>Options:</span> <span id="ba6-options">0cr</span></div>
                    <div class="credits-line credits-total"><span>Total Selected:</span> <span id="ba6-total">0cr</span>
                    </div>
                    <div class="credits-line credits-final"><span>Semester Total:</span> <span
                            id="ba6-final">14cr</span></div>
                </div>
            </div>
        </div>

        <!-- Overall Summary -->
        <div class="overall-summary">
            <h3 style="margin-bottom: 15px;">Overall 3rd Year Summary</h3>
            <div class="credits-line">
                <span>Bio/Physique Group:</span>
                <span>
                    <span id="total-bio">0 credits (need 4+)</span>
                    <span class="requirement-status incomplete" id="bio-status">INCOMPLETE</span>
                </span>
            </div>
            <div class="credits-line">
                <span>Projects Group:</span>
                <span>
                    <span id="total-projects">0 credits (need 8+)</span>
                    <span class="requirement-status incomplete" id="projects-status">INCOMPLETE</span>
                </span>
            </div>
            <div class="credits-line">
                <span>Options Group:</span>
                <span>
                    <span id="total-options">0 credits (need 28+)</span>
                    <span class="requirement-status incomplete" id="options-status">INCOMPLETE</span>
                </span>
            </div>
            <div class="credits-line"><span>Bloc C (Fixed):</span> <span>18 credits <span
                        class="requirement-status complete">COMPLETE</span></span></div>
            <div class="credits-line"><span>SHS (Fixed):</span> <span>4 credits <span
                        class="requirement-status complete">COMPLETE</span></span></div>
            <div class="credits-line credits-total"><span>Total 3rd Year:</span> <span id="grand-total">22 credits (need
                    62)</span></div>
        </div>
    </div>

    <script src="courses.js"></script>
    <script>

        let selectedCourses = {
            BA5: [],
            BA6: []
        };

        // Track course toggles (courseId -> currentGroup)
        let courseToggles = {};
        // Track semester choices for flexible courses (only research project)
        let courseSemesters = {
            'CS-304': 'BA5'     // Research project can be in BA5 or BA6
        };

        function openCourseLink(url) {
            window.open(url, '_blank');
        }

        function generateCourseCard(course) {
            const isToggleable = course.toggleable === true;
            const currentGroup = courseToggles[course.id] || course.group;
            let semesterDisplay = course.semesters[0]; // Show semester from course data

            // Check if this course has flexible semester selection
            const hasFlexibleSemester = courseSemesters.hasOwnProperty(course.id);
            if (hasFlexibleSemester) {
                semesterDisplay = courseSemesters[course.id];
            }

            let toggleSection = '';
            if (isToggleable || hasFlexibleSemester) {
                toggleSection = '<div class="toggle-section">';

                // Group toggle (for toggleable courses)
                if (isToggleable) {
                    toggleSection += `
                        <div class="toggle-row">
                            <span>Count as:</span>
                            <button class="toggle-button" onclick="toggleCourseGroup('${course.id}')" id="toggle-${course.id}">
                                ${currentGroup === course.group ?
                            (course.group === 'bio-physique' ? 'Bio/Physique' : course.group.charAt(0).toUpperCase() + course.group.slice(1)) :
                            'Options'}
                            </button>
                        </div>
                    `;
                }

                // Semester toggle (for flexible semester courses)
                if (hasFlexibleSemester) {
                    toggleSection += `
                        <div class="toggle-row">
                            <span>Semester:</span>
                            <button class="toggle-button" onclick="toggleCourseSemester('${course.id}')" id="semester-${course.id}">
                                ${courseSemesters[course.id]}
                            </button>
                        </div>
                    `;
                }

                toggleSection += '</div>';
            }

            return `
                <div class="course-card ${course.group}-card" 
                     data-course="${course.id}" 
                     data-credits="${course.credits}" 
                     data-group="${course.group}" 
                     data-current-group="${currentGroup}"
                     data-semesters="${course.semesters.join(',')}"
                     data-toggleable="${isToggleable}">
                    <div class="course-title">${course.title}</div>
                    <div class="course-code">${course.code}</div>
                    <div class="course-details">
                        <div class="course-details-left">
                            <span class="course-group-indicator ${currentGroup}">${currentGroup === 'bio-physique' ? 'Bio/Physique' :
                    currentGroup.charAt(0).toUpperCase() + currentGroup.slice(1)
                }</span>
                            <span class="course-semester">${semesterDisplay}</span>
                            <span class="course-language">${course.language}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <button class="info-button" onclick="window.open('${course.link}', '_blank')">Link</button>
                            <span class="course-credits">${course.credits}cr</span>
                        </div>
                    </div>
                    ${toggleSection}
                </div>
            `;
        }

        function generateCourseGroup(groupName, courses, requirements) {
            const groupKey = groupName.toLowerCase().replace('/', '-');

            // Separate courses by their semester
            const ba5Courses = courses.filter(c => c.semesters.includes('BA5'));
            const ba6Courses = courses.filter(c => c.semesters.includes('BA6'));

            let courseCards = '';

            // BA5 courses
            if (ba5Courses.length > 0) {
                ba5Courses.sort((a, b) => a.title.localeCompare(b.title));
                ba5Courses.forEach(course => {
                    courseCards += generateCourseCard(course);
                });
            }

            // Separator line if needed
            if (ba5Courses.length > 0 && ba6Courses.length > 0) {
                courseCards += '<div class="semester-separator"></div>';
            }

            // BA6 courses
            if (ba6Courses.length > 0) {
                ba6Courses.sort((a, b) => a.title.localeCompare(b.title));
                ba6Courses.forEach(course => {
                    courseCards += generateCourseCard(course);
                });
            }

            return `
                <div class="course-group ${groupKey}">
                    <div class="group-header" onclick="toggleGroup('${groupKey}')">
                        <h3>${groupName} Group (${requirements})</h3>
                        <div class="group-info">
                            <span class="group-credits" id="${groupKey}-credits">0 cr</span>
                            <span class="toggle" id="${groupKey}-toggle">−</span>
                        </div>
                    </div>
                    <div class="course-grid" id="${groupKey}-courses">
                        ${courseCards}
                    </div>
                </div>
            `;
        }

        function generateAllCourses() {
            const container = document.getElementById('courses-container');
            let html = '';

            html += generateCourseGroup('Bio/Physique', courseData['bio-physique'], '4+ credits required');
            html += generateCourseGroup('Projects', courseData['projects'], '8+ credits required');
            html += generateCourseGroup('Options', courseData['options'], '28+ credits required');

            container.innerHTML = html;
        }

        function toggleGroup(groupId) {
            const courses = document.getElementById(groupId + '-courses');
            const toggle = document.getElementById(groupId + '-toggle');

            if (courses.classList.contains('hidden')) {
                courses.classList.remove('hidden');
                toggle.textContent = '−';
            } else {
                courses.classList.add('hidden');
                toggle.textContent = '+';
            }
        }

        function toggleCourseGroup(courseId) {
            const courseCard = document.querySelector(`[data-course="${courseId}"]`);
            if (!courseCard) return;

            const originalGroup = courseCard.dataset.group;
            const currentGroup = courseToggles[courseId] || originalGroup;

            // Toggle between original group and options
            const newGroup = currentGroup === originalGroup ? 'options' : originalGroup;
            courseToggles[courseId] = newGroup;

            // Update course card
            courseCard.dataset.currentGroup = newGroup;

            // Update group indicator
            const groupIndicator = courseCard.querySelector('.course-group-indicator');
            groupIndicator.className = `course-group-indicator ${newGroup}`;
            groupIndicator.textContent = newGroup === 'bio-physique' ? 'Bio/Physique' :
                newGroup.charAt(0).toUpperCase() + newGroup.slice(1);

            // Update toggle button
            const toggleBtn = document.getElementById(`toggle-${courseId}`);
            if (toggleBtn) {
                toggleBtn.textContent = newGroup === originalGroup ?
                    (originalGroup === 'bio-physique' ? 'Bio/Physique' : originalGroup.charAt(0).toUpperCase() + originalGroup.slice(1)) :
                    'Options';
            }

            // If course is already selected, update its group and re-render
            if (isCourseSelected(courseId)) {
                updateSelectedCourseGroup(courseId, newGroup);
                renderSelectedCourses();
            }
            updateCredits();
        }

        function toggleCourseSemester(courseId) {
            // Toggle semester for flexible courses
            const currentSemester = courseSemesters[courseId];
            const newSemester = currentSemester === 'BA5' ? 'BA6' : 'BA5';
            courseSemesters[courseId] = newSemester;

            // Update semester display in course card
            const courseCard = document.querySelector(`[data-course="${courseId}"]`);
            if (courseCard) {
                const semesterElement = courseCard.querySelector('.course-semester');
                if (semesterElement) {
                    semesterElement.textContent = newSemester;
                }
            }

            // Update toggle button
            const semesterBtn = document.getElementById(`semester-${courseId}`);
            if (semesterBtn) {
                semesterBtn.textContent = newSemester;
            }

            // If course is already selected, move it to the new semester
            if (isCourseSelected(courseId)) {
                moveCourseBetweenSemesters(courseId, newSemester);
                renderSelectedCourses();
            }
            updateCredits();
        }

        function moveCourseBetweenSemesters(courseId, targetSemester) {
            let courseData = null;
            ['BA5', 'BA6'].forEach(semester => {
                const courseIndex = selectedCourses[semester].findIndex(c => c.id === courseId);
                if (courseIndex !== -1) {
                    courseData = selectedCourses[semester].splice(courseIndex, 1)[0];
                }
            });

            if (courseData) {
                selectedCourses[targetSemester].push(courseData);
            }
        }

        function updateSelectedCourseGroup(courseId, newGroup) {
            ['BA5', 'BA6'].forEach(semester => {
                const courseIndex = selectedCourses[semester].findIndex(c => c.id === courseId);
                if (courseIndex !== -1) {
                    selectedCourses[semester][courseIndex].group = newGroup;
                }
            });
        }

        document.addEventListener('click', function (e) {
            // Check if clicked element is inside a course card
            const courseCard = e.target.closest('.course-card');

            if (courseCard && !e.target.closest('.toggle-section') && !e.target.classList.contains('info-button')) {
                toggleCourse(courseCard);
            } else if (e.target.classList.contains('remove-btn')) {
                removeCourse(e.target.dataset.courseId, e.target.dataset.semester);
            }
            // Note: semester-toggle-btn clicks are handled by their onclick attribute
        });

        function toggleCourse(courseCard) {
            const courseId = courseCard.dataset.course;

            if (isCourseSelected(courseId)) {
                // Remove course
                ['BA5', 'BA6'].forEach(semester => {
                    selectedCourses[semester] = selectedCourses[semester].filter(course => course.id !== courseId);
                });
                courseCard.classList.remove('selected');
            } else {
                // Determine target semester
                let targetSemester;

                // Check if this is a flexible semester course
                if (courseSemesters.hasOwnProperty(courseId)) {
                    targetSemester = courseSemesters[courseId];
                } else {
                    // Use direct semester from course data
                    const semesters = courseCard.dataset.semesters.split(',');
                    targetSemester = semesters[0]; // Take first available semester
                }

                addCourseToSemester(courseCard, targetSemester);
            }

            renderSelectedCourses();
            updateCredits();
        }

        function addCourseToSemester(courseCard, semester) {
            const courseId = courseCard.dataset.course;
            const credits = parseInt(courseCard.dataset.credits);
            const currentGroup = courseToggles[courseId] || courseCard.dataset.group;

            const title = courseCard.querySelector('.course-title').textContent;
            const code = courseCard.querySelector('.course-code').textContent;

            const courseData = {
                id: courseId,
                title: title,
                code: code,
                credits: credits,
                group: currentGroup
            };

            selectedCourses[semester].push(courseData);
            courseCard.classList.add('selected');
        }

        function removeCourse(courseId, semester) {
            selectedCourses[semester] = selectedCourses[semester].filter(course => course.id !== courseId);

            // Unmark course card
            const courseCard = document.querySelector(`[data-course="${courseId}"]`);
            if (courseCard) {
                courseCard.classList.remove('selected');
            }

            renderSelectedCourses();
            updateCredits();
        }

        function isCourseSelected(courseId) {
            return selectedCourses.BA5.some(c => c.id === courseId) ||
                selectedCourses.BA6.some(c => c.id === courseId);
        }

        function renderSelectedCourses() {
            ['BA5', 'BA6'].forEach(semester => {
                // Clear all category sections
                ['options', 'projects', 'bio'].forEach(category => {
                    const container = document.getElementById(`${semester.toLowerCase()}-${category}-list`);
                    container.innerHTML = '';
                });

                // Group courses by category
                const coursesByCategory = {
                    options: [],
                    projects: [],
                    'bio-physique': []
                };

                selectedCourses[semester].forEach(course => {
                    if (coursesByCategory[course.group]) {
                        coursesByCategory[course.group].push(course);
                    }
                });

                // Render each category
                Object.keys(coursesByCategory).forEach(category => {
                    const courses = coursesByCategory[category];
                    if (courses.length === 0) return;

                    // Sort alphabetically
                    courses.sort((a, b) => a.title.localeCompare(b.title));

                    const containerKey = category === 'bio-physique' ? 'bio' : category;
                    const container = document.getElementById(`${semester.toLowerCase()}-${containerKey}-list`);

                    courses.forEach(course => {
                        const courseDiv = document.createElement('div');
                        courseDiv.className = 'selected-course';

                        // Check if this course can be moved between semesters
                        const canMoveSemesters = courseSemesters.hasOwnProperty(course.id);
                        const semesterToggle = canMoveSemesters ?
                            `<button class="semester-toggle-btn" onclick="moveSelectedCourseToOtherSemester('${course.id}', '${semester}')" title="Move to other semester">↔</button>` : '';

                        courseDiv.innerHTML = `
                            <div>
                                <strong>${course.title}</strong><br>
                                <small>${course.code} • ${course.credits}cr</small>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                ${semesterToggle}
                                <button class="remove-btn" data-course-id="${course.id}" data-semester="${semester}">✕</button>
                            </div>
                        `;
                        container.appendChild(courseDiv);
                    });
                });
            });
        }

        function moveSelectedCourseToOtherSemester(courseId, currentSemester) {
            const targetSemester = currentSemester === 'BA5' ? 'BA6' : 'BA5';

            // Update the courseSemesters tracking
            if (courseSemesters.hasOwnProperty(courseId)) {
                courseSemesters[courseId] = targetSemester;

                // Update the course card semester display
                const courseCard = document.querySelector(`[data-course="${courseId}"]`);
                if (courseCard) {
                    const semesterElement = courseCard.querySelector('.course-semester');
                    if (semesterElement) {
                        semesterElement.textContent = targetSemester;
                    }

                    // Update semester toggle button in course card
                    const semesterBtn = document.getElementById(`semester-${courseId}`);
                    if (semesterBtn) {
                        semesterBtn.textContent = targetSemester;
                    }
                }
            }

            // Move the course between semesters
            moveCourseBetweenSemesters(courseId, targetSemester);
            renderSelectedCourses();
            updateCredits();
        }

        function updateCredits() {
            ['BA5', 'BA6'].forEach(semester => {
                const courses = selectedCourses[semester];

                const bio = courses.filter(c => c.group === 'bio-physique').reduce((sum, c) => sum + c.credits, 0);
                const projects = courses.filter(c => c.group === 'projects').reduce((sum, c) => sum + c.credits, 0);
                const options = courses.filter(c => c.group === 'options').reduce((sum, c) => sum + c.credits, 0);
                const total = bio + projects + options;

                document.getElementById(semester.toLowerCase() + '-bio').textContent = bio + 'cr';
                document.getElementById(semester.toLowerCase() + '-projects').textContent = projects + 'cr';
                document.getElementById(semester.toLowerCase() + '-options').textContent = options + 'cr';
                document.getElementById(semester.toLowerCase() + '-total').textContent = total + 'cr';

                const fixed = semester === 'BA5' ? 8 : 14; // BA5: 6+2, BA6: 12+2
                document.getElementById(semester.toLowerCase() + '-final').textContent = (total + fixed) + 'cr';

                // Update top summary
                document.getElementById('top-' + semester.toLowerCase() + '-credits').textContent = (total + fixed) + 'cr';
            });

            // Update overall summary
            const totalBio = selectedCourses.BA5.concat(selectedCourses.BA6)
                .filter(c => c.group === 'bio-physique').reduce((sum, c) => sum + c.credits, 0);
            const totalProjects = selectedCourses.BA5.concat(selectedCourses.BA6)
                .filter(c => c.group === 'projects').reduce((sum, c) => sum + c.credits, 0);
            const totalOptions = selectedCourses.BA5.concat(selectedCourses.BA6)
                .filter(c => c.group === 'options').reduce((sum, c) => sum + c.credits, 0);

            document.getElementById('total-bio').textContent = `${totalBio} credits (need 4+)`;
            document.getElementById('total-projects').textContent = `${totalProjects} credits (need 8+)`;
            document.getElementById('total-options').textContent = `${totalOptions} credits (need 28+)`;

            // Update requirement status
            updateRequirementStatus('bio', totalBio >= 4);
            updateRequirementStatus('projects', totalProjects >= 8);
            updateRequirementStatus('options', totalOptions >= 28);

            const grandTotal = totalBio + totalProjects + totalOptions + 22; // +22 for Bloc C + SHS
            document.getElementById('grand-total').textContent = `${grandTotal} credits (need 62)`;
            document.getElementById('top-total-credits').textContent = `${grandTotal} / 62cr`;

            // Update group credit counters in headers
            if (document.getElementById('bio-physique-credits')) {
                document.getElementById('bio-physique-credits').textContent = `${totalBio} cr`;
            }
            if (document.getElementById('projects-credits')) {
                document.getElementById('projects-credits').textContent = `${totalProjects} cr`;
            }
            if (document.getElementById('options-credits')) {
                document.getElementById('options-credits').textContent = `${totalOptions} cr`;
            }
        }

        function updateRequirementStatus(groupName, isComplete) {
            const statusElement = document.getElementById(`${groupName}-status`);
            if (isComplete) {
                statusElement.textContent = 'COMPLETE';
                statusElement.className = 'requirement-status complete';
            } else {
                statusElement.textContent = 'INCOMPLETE';
                statusElement.className = 'requirement-status incomplete';
            }
        }

        // Initialize the interface
        generateAllCourses();
        updateCredits();
    </script>
</body>

</html>
